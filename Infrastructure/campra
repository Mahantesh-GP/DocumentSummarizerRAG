using System.Net.Http.Headers;
using System.Text;
using System.Text.Json;

class Program
{
    static async Task Main(string[] args)
    {
        string endpoint = "https://<your-search-service>.search.windows.net";
        string apiKey = "<your-api-key>";
        string indexName = "<your-index-name>";

        string queryText = "What is the refund policy?";

        var httpClient = new HttpClient();
        httpClient.DefaultRequestHeaders.Add("api-key", apiKey);
        httpClient.DefaultRequestHeaders.Accept.Add(new MediaTypeWithQualityHeaderValue("application/json"));

        var requestBody = new
        {
            search = queryText,
            queryType = "semantic",
            semanticConfiguration = "default",
            captions = "extractive",
            answers = "extractive",
            top = 3,
            vectorQueries = new[]
            {
                new
                {
                    kind = "text",
                    text = queryText,
                    fields = new[] { "embedding" }, // your vector field name
                    kNearestNeighborsCount = 3
                }
            }
        };

        string requestUrl = $"{endpoint}/indexes/{indexName}/docs/search?api-version=2025-03-01-preview";
        var content = new StringContent(JsonSerializer.Serialize(requestBody), Encoding.UTF8, "application/json");

        var response = await httpClient.PostAsync(requestUrl, content);

        if (response.IsSuccessStatusCode)
        {
            string json = await response.Content.ReadAsStringAsync();
            Console.WriteLine("✅ Search Results:");
            Console.WriteLine(json);
        }
        else
        {
            Console.WriteLine($"❌ Error: {response.StatusCode}");
            string error = await response.Content.ReadAsStringAsync();
            Console.WriteLine(error);
        }
    }
}

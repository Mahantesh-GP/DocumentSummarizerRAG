using System.Reflection.PortableExecutable;
using System.Text.RegularExpressions;
using System.Text;
using iTextSharp.text.pdf;
using iTextSharp.text.pdf.parser;

namespace DocRagSummary.API.Services
{
    public class DocumentService
    {

        public async Task<string> UploadFileAsync(IFormFile file)
        {           

            string extractedText = await ExtractTextFromFile(file);

            return extractedText;
        }
        private async Task<string> ExtractTextFromFile(IFormFile file)
        {
            string extractedText;
            using (var stream = file.OpenReadStream())
            {

                using var reader = new PdfReader(stream);
                StringBuilder text = new StringBuilder();
                for (int i = 1; i <= reader.NumberOfPages; i++)
                {
                    text.Append(PdfTextExtractor.GetTextFromPage(reader, i));
                }
                extractedText = text.ToString();
            }

            return extractedText;
        }
    }
}

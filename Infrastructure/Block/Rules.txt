@inject HttpClient Http

<h3>File Upload Form</h3>

<form @onsubmit="UploadFile">
    <InputFile OnChange="HandleFileSelected" multiple="false" />
    <button type="submit" disabled="@isUploading">Upload</button>
</form>

<p>@statusMessage</p>

@code {
    private IBrowserFile? selectedFile;
    private string statusMessage = "Select a file and click upload.";
    private bool isUploading = false;

    private void HandleFileSelected(InputFileChangeEventArgs e)
    {
        selectedFile = e.File;
        statusMessage = $"Selected file: {selectedFile?.Name}";
    }

    private async Task UploadFile(FormSubmitEventArgs e)
    {
        if (selectedFile == null)
        {
            statusMessage = "Please select a file before uploading.";
            return;
        }

        isUploading = true;
        var content = new MultipartFormDataContent();
        var stream = selectedFile.OpenReadStream(maxAllowedSize: 1024 * 1024 * 10); // 10MB limit
        var fileContent = new StreamContent(stream);
        content.Add(fileContent, "file", selectedFile.Name);

        var response = await Http.PostAsync("https://localhost:5001/api/upload", content);
        
        if (response.IsSuccessStatusCode)
        {
            statusMessage = "File uploaded successfully!";
        }
        else
        {
            statusMessage = $"Upload failed: {response.ReasonPhrase}";
        }

        isUploading = false;
    }
}

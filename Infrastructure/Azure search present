
public static Dictionary<string, string> FlattenJson(string json)
{
    var dict = new Dictionary<string, string>();
    FlattenToken(JToken.Parse(json), dict);
    return dict;
}

private static void FlattenToken(JToken token, Dictionary<string, string> dict, string prefix = "")
{
    if (token is JObject obj)
    {
        foreach (var prop in obj.Properties())
        {
            FlattenToken(prop.Value, dict, $"{prefix}{prop.Name}.");
        }
    }
    else if (token is JArray array)
    {
        for (int i = 0; i < array.Count; i++)
        {
            FlattenToken(array[i], dict, $"{prefix}[{i}].");
        }
    }
    else
    {
        dict[prefix.TrimEnd('.')] = token.ToString();
    }
}

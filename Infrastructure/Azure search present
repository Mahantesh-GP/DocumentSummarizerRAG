
using CsvHelper;
using CsvHelper.Configuration;
using CsvToJson.Data;
using Newtonsoft.Json;
using System.Globalization;

string csvPath = "people.csv";
string outputJsonPath = "people-documents.json";

List<Person> people = new();

using (var reader = new StreamReader(csvPath))
using (var csv = new CsvReader(reader, new CsvConfiguration(CultureInfo.InvariantCulture)
{
    HasHeaderRecord = true
}))
{
    while (csv.Read())
    {
        var fullName = csv.GetField("FullName");
        var nickNamesRaw = csv.GetField("NickNames");
        var address = csv.GetField("Address");

        var nickNames = nickNamesRaw
            .Split(new[] { ',', ';' }, StringSplitOptions.RemoveEmptyEntries)
            .Select(n => n.Trim())
            .ToList();

        people.Add(new Person
        {
            FullName = fullName,
            NickNames = nickNames,
            Address = address
        });
    }
}

// Serialize to JSON
string json = JsonConvert.SerializeObject(people, Formatting.Indented);
File.WriteAllText(outputJsonPath, json);

Console.WriteLine($"âœ… JSON output saved to {outputJsonPath}");

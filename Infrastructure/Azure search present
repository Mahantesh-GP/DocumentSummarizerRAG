
using ExcelDataReader;
using Newtonsoft.Json;
using System.Data;
using System.Text;

System.Text.Encoding.RegisterProvider(System.Text.CodePagesEncodingProvider.Instance);

string folderPath = "Excels";
string outputJsonPath = "all-people-documents.json";
List<Person> allPeople = new();

foreach (var file in Directory.GetFiles(folderPath, "*.xls*")) // handles both .xls and .xlsx
{
    using var stream = File.Open(file, FileMode.Open, FileAccess.Read);
    using var reader = ExcelReaderFactory.CreateReader(stream);
    var result = reader.AsDataSet();

    var table = result.Tables[0]; // First sheet
    for (int i = 1; i < table.Rows.Count; i++) // Skip header
    {
        var row = table.Rows[i];

        string fullName = row[0]?.ToString()?.Trim() ?? "";
        string nickNamesRaw = row[1]?.ToString() ?? "";
        string address = row[2]?.ToString() ?? "";

        var nickNames = nickNamesRaw
            .Split(new[] { ',', ';' }, StringSplitOptions.RemoveEmptyEntries)
            .Select(n => n.Trim())
            .ToList();

        allPeople.Add(new Person
        {
            Id = Guid.NewGuid().ToString(),
            FullName = fullName,
            NickNames = nickNames,
            Address = address
        });
    }

    Console.WriteLine($"✅ Processed: {Path.GetFileName(file)}");
}

// Write to JSON
string json = JsonConvert.SerializeObject(allPeople, Formatting.Indented);
File.WriteAllText(outputJsonPath, json);
Console.WriteLine($"\n✅ JSON saved to {outputJsonPath}");

public class Person
{
    public string Id { get; set; }
    public string FullName { get; set; }
    public List<string> NickNames { get; set; }
    public string Address { get; set; }
}

using ClosedXML.Excel;
using Newtonsoft.Json;
using System.Text.Json.Serialization;

string folderPath = "Excels"; // Folder containing all Excel files
string outputJsonPath = "all-people-documents.json";

List<Person> allPeople = new();

foreach (var file in Directory.GetFiles(folderPath, "*.xlsx"))
{
    using var workbook = new XLWorkbook(file);
    var worksheet = workbook.Worksheet(1);
    var rows = worksheet.RangeUsed().RowsUsed().Skip(1); // Skip header

    foreach (var row in rows)
    {
        string fullName = row.Cell(1).GetString();
        string nickNamesRaw = row.Cell(2).GetString();
        string address = row.Cell(3).GetString();

        List<string> nickNames = nickNamesRaw
            .Split(new[] { ',', ';' }, StringSplitOptions.RemoveEmptyEntries)
            .Select(n => n.Trim())
            .ToList();

        allPeople.Add(new Person
        {
            Id = Guid.NewGuid().ToString(),
            FullName = fullName,
            NickNames = nickNames,
            Address = address
        });
    }

    Console.WriteLine($"✅ Processed: {Path.GetFileName(file)}");
}

// Write all people to single JSON
var json = JsonConvert.SerializeObject(allPeople, Formatting.Indented);
File.WriteAllText(outputJsonPath, json);
Console.WriteLine($"\n✅ All records saved to {outputJsonPath}");
